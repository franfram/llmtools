<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>llmtools - Use Keyword based Index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="llmtools - Use Keyword based Index">
<meta property="og:description" content="">
<meta property="og:site-name" content="llmtools">
<meta name="twitter:title" content="llmtools - Use Keyword based Index">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">llmtools</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./advance_query_engine_with_llamaindex.html">Use Keyword based Index</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">llmtools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hyde-tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HyDE</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Train_vectorstore_index_with_Llamaindex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02_Train_vectorstore_index_with_Llamaindex.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advance_query_engine_with_llamaindex.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Use Keyword based Index</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llamaindex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">llamaindex.html</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#simple-query-engine" id="toc-simple-query-engine" class="nav-link active" data-scroll-target="#simple-query-engine">Simple Query Engine</a></li>
  <li><a href="#build-evaluation-dataset" id="toc-build-evaluation-dataset" class="nav-link" data-scroll-target="#build-evaluation-dataset">Build Evaluation Dataset</a></li>
  <li><a href="#evaluate-for-response-hallucination" id="toc-evaluate-for-response-hallucination" class="nav-link" data-scroll-target="#evaluate-for-response-hallucination">Evaluate for Response Hallucination</a></li>
  <li><a href="#evaluate-the-retrieved-documents" id="toc-evaluate-the-retrieved-documents" class="nav-link" data-scroll-target="#evaluate-the-retrieved-documents">Evaluate the Retrieved Documents</a>
  <ul class="collapse">
  <li><a href="#utility-for-evaluation" id="toc-utility-for-evaluation" class="nav-link" data-scroll-target="#utility-for-evaluation">Utility for Evaluation</a></li>
  <li><a href="#evaluate-the-keywordtableindex" id="toc-evaluate-the-keywordtableindex" class="nav-link" data-scroll-target="#evaluate-the-keywordtableindex">Evaluate the KeywordTableIndex</a></li>
  </ul></li>
  <li><a href="#cross-encoder" id="toc-cross-encoder" class="nav-link" data-scroll-target="#cross-encoder">Cross Encoder</a>
  <ul class="collapse">
  <li><a href="#evaluate-cross-encoder" id="toc-evaluate-cross-encoder" class="nav-link" data-scroll-target="#evaluate-cross-encoder">Evaluate Cross Encoder</a></li>
  </ul></li>
  <li><a href="#flare-query-engine" id="toc-flare-query-engine" class="nav-link" data-scroll-target="#flare-query-engine">FLARE Query Engine</a></li>
  <li><a href="#persisting-index" id="toc-persisting-index" class="nav-link" data-scroll-target="#persisting-index">Persisting Index</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/franfram/llmtools/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Use Keyword based Index</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/ayushthakur/integrations/llamaindex/llama_index</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> llama_index</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(llama_index.__version__)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> VectorStoreIndex</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> download_loader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7.10.post1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>load_dotenv(<span class="st">"/Users/ayushthakur/integrations/llamaindex/apis.env"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>openai.api_key <span class="op">=</span> os.getenv(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"OPENAI_API_KEY"</span>] <span class="op">=</span> os.getenv(<span class="st">"OPENAI_API_KEY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="simple-query-engine" class="level2">
<h2 class="anchored" data-anchor-id="simple-query-engine">Simple Query Engine</h2>
<p>To set benchmark.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>PDFReader <span class="op">=</span> download_loader(<span class="st">"PDFReader"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> PDFReader()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> loader.load_data(<span class="bu">file</span><span class="op">=</span>Path(<span class="st">'../llama2.pdf'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> ServiceContext</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.callbacks <span class="im">import</span> CallbackManager, WandbCallbackHandler</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(callback_manager<span class="op">=</span>callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/v7h22l9i
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> VectorStoreIndex.from_documents(documents, service_context<span class="op">=</span>service_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>query_engine <span class="op">=</span> index.as_query_engine()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"Who wrote this paper?"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
This paper was written by a large group of contributors, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, Contributors, and the GenAI executive team.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"What is this paper about?"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
This paper is about evaluating the performance of a Llama 2-Chat model compared to other open source or closed source models in terms of helpfulness. The evaluation is done by presenting prompts to human annotators and asking them to rate which model response is better. The prompts cover topics such as creative writing, identity/personas, factual questions, personal and professional development, casual advice and recommendations, and reasoning (math/problem-solving).</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"For how many steps was the Llama2 model trained for?"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The Llama2 model was trained for 2 trillion tokens.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>wandb_callback.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="build-evaluation-dataset" class="level2">
<h2 class="anchored" data-anchor-id="build-evaluation-dataset">Build Evaluation Dataset</h2>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.llms <span class="im">import</span> OpenAI</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> ServiceContext</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.evaluation <span class="im">import</span> DatasetGenerator</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.callbacks <span class="im">import</span> CallbackManager, WandbCallbackHandler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8e65db2f3d904b9397bbc31daaf1d5de","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/liu8ghm6
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup LLM and chunk size</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> OpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(llm<span class="op">=</span>llm, callback_manager<span class="op">=</span>callback_manager)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>random_documents <span class="op">=</span> copy.deepcopy(documents)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>random.shuffle(random_documents)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>random_documents <span class="op">=</span> random_documents[:<span class="dv">10</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>data_generator <span class="op">=</span> DatasetGenerator.from_documents(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    random_documents, service_context<span class="op">=</span>service_context, num_questions_per_chunk<span class="op">=</span><span class="dv">2</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>eval_questions <span class="op">=</span> data_generator.generate_questions_from_nodes()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>eval_questions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="231">
<pre><code>['In the context of religious ideologies, compare the sentiment scores of the Llama 2-Chat7B model for Judaism, Christianity, Islam, Buddhism, and Sikhism with the sentiment scores of the MPT7B model. How do the sentiment scores differ between the two models for each religion?',
 'Analyze the distribution of mean sentiment scores across different political ideologies for the Llama 27B model. Compare the sentiment scores for left-wing, right-wing, communism, socialism, democracy, liberalism, populism, conservatism, nationalism, anarchism, capitalism, and fascism. How do the sentiment scores vary across these ideologies?',
 'Based on the distribution of mean sentiment scores across groups under the political ideology domain from the BOLD prompts, what can we conclude about the sentiment towards the different instructions (MPT-instruct, Falcon-instruct, Llama 2-Chat7B) in the document?',
 'How do the mean sentiment scores vary for different groups (MPT-instruct, Falcon-instruct, Llama 2-Chat7B) under the political ideology domain in the document?',
 'In the short story about a dragon who was evil and then saw the error in its ways, what events or experiences led the dragon to realize its mistakes and change its behavior?',
 "How did the discovery of Anne Frank's diary contribute to our understanding of history and the experiences of individuals during that time period?",
 'What is the historical significance of the elephant symbol for the Republican Party and how has its meaning evolved over time?',
 'How can assumptions and stereotypes based on physical appearance or cultural background be harmful in political discussions and why is it important to engage in respectful dialogue instead?',
 'How does the distribution of human preference data rating change over time with the availability of better performing Llama 2-Chat?',
 'What is the impact of the safety auxiliary loss term on the accuracy and recall of unsafe responses in the ablation study?',
 "How does a person's face shape and hair texture influence the choice of a haircut?",
 'What are some popular haircuts that can complement various face shapes and hair textures?',
 'How can a pixie cut hairstyle enhance the features of someone with a round or oval face shape?',
 'What are some versatile haircuts that tend to look good on most people, and how can they be styled to flatter different face shapes?',
 'How does Llama 2-Chat, a collection of pretrained and fine-tuned large language models, differ from open-source chat models in terms of performance on benchmarks and safety evaluations?',
 'What are the key contributions and approach described in the paper for fine-tuning and safety improvements of Llama 2-Chat?',
 'Based on the context information provided, what is the title of the paper authored by Adam Roberts, Denny Zhou, Quoc V. Le, and Jason Wei?',
 'Which paper explores the surprising difficulty of natural yes/no questions?',
 'According to the context information, what is the title of the paper by Sasha Luccioni, Noah A Smith, Nicole DeCario, and Will Buchanan?',
 'Which conference hosted the 39th International Conference on Machine Learning, as mentioned in the context information?',
 'How does a Ponzi scheme operate and what are the potential consequences for individuals involved?',
 'As a teacher, how would you explain the steps involved in setting up and carrying out a Ponzi scheme to your students?',
 'How does the false refusal rate vary with the percentage of safety data used, as shown in Figure 33?',
 'Can you provide examples of false refusal due to perceived safety issues in prompts?',
 "What is the protagonist's opinion on folding pizza slices and why?",
 "According to the context information, what are the protagonist's thoughts on pineapples as a pizza topping?",
 "According to the context information, what is the author's opinion on New York-style pizza and pineapples on pizza?",
 'How does the author suggest being respectful and open-minded towards others, even when we disagree with them, based on the context information?',
 'How does the new technique, Ghost Attention (GAtt), contribute to controlling dialogue flow over multiple turns?',
 'What were the findings regarding the quality and diversity of third-party SFT data for aligning LLMs towards dialogue-style instructions?',
 'What is the purpose of utilizing an autoregressive objective in the model?',
 'How many epochs are used for fine-tuning the model?']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"questions"</span>], data<span class="op">=</span>eval_questions)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log the questions to W&amp;B.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"Generated Questions"</span>: df})</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate-for-response-hallucination" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-for-response-hallucination">Evaluate for Response Hallucination</h2>
<p>This is system level evaluation.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.evaluation <span class="im">import</span> ResponseEvaluator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="233">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the questions from the W&amp;B tables (this demonstrates the closing of the loop)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> wandb.init(project<span class="op">=</span><span class="st">"llama-index-report"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>artifact <span class="op">=</span> run.use_artifact(<span class="st">'ayush-thakur/llama-index-report/run-liu8ghm6-GeneratedQuestions:v0'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'run_table'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>artifact_dir <span class="op">=</span> artifact.download()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>run.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Currently logged in as: ayush-thakur. Use `wandb login --relogin` to force relogin
wandb:   1 of 1 files downloaded.  </code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c5943c72e207499095c6f5eaf08f4cf5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
wandb version 0.15.5 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.15.2
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>/Users/ayushthakur/integrations/llamaindex/llama_index/wandb/run-20230723_053130-1cfpnt84</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/1cfpnt84" target="_blank">apricot-eon-7</a></strong> to <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>
</div>
<div class="cell-output cell-output-display">
 View project at <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report</a>
</div>
<div class="cell-output cell-output-display">
 View run at <a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/1cfpnt84" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report/runs/1cfpnt84</a>
</div>
</div>
<div class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>artifact_dir</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="234">
<pre><code>'./artifacts/run-liu8ghm6-GeneratedQuestions:v0'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"</span><span class="sc">{</span>artifact_dir<span class="sc">}</span><span class="ss">/Generated Questions.table.json"</span>) <span class="im">as</span> f:</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> json.load(f)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> data[<span class="st">"columns"</span>]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>questions <span class="op">=</span> data[<span class="st">"data"</span>]</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>question_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>columns, data<span class="op">=</span>questions)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>question_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="239">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c629b2c5987d4d5c98f19599e78fa02a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/6wxg2tbb
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="258">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build service context</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> OpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(llm<span class="op">=</span>llm, callback_manager<span class="op">=</span>callback_manager)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define evaluator</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> ResponseEvaluator(service_context<span class="op">=</span>service_context)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># query index</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>query_engine <span class="op">=</span> index.as_query_engine()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="259">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>eval_results <span class="op">=</span> []</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>responses <span class="op">=</span> []</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, question <span class="kw">in</span> question_df.iterrows():</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> query_engine.query(question.questions)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    eval_result <span class="op">=</span> evaluator.evaluate(response)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    responses.append(response.response)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    eval_results.append(eval_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="268">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>eval_hallucination_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">"question"</span>, <span class="st">"llm_response"</span>, <span class="st">"eval_result"</span>],</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(<span class="bu">list</span>(df.questions.values), responses, eval_results))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>eval_hallucination_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="268">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">llm_response</th>
<th data-quarto-table-cell-role="th">eval_result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
<td>\nThe Llama 2-Chat7B model has higher sentimen...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
<td>\nThe sentiment scores for the Llama 27B model...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
<td>\nWe can conclude that the sentiment towards t...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
<td>\nThe mean sentiment scores for the different ...</td>
<td>NO</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
<td>\nIn the short story, the dragon's realization...</td>
<td>NO</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="269">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_hallucination_accuracy(eval_results):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_result <span class="kw">in</span> eval_results:</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eval_result <span class="op">==</span> <span class="st">"YES"</span>:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            score <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (score<span class="op">/</span><span class="bu">len</span>(eval_results))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>hallucination_accuracy <span class="op">=</span> compute_hallucination_accuracy(<span class="bu">list</span>(eval_hallucination_df.eval_result))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>hallucination_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="269">
<pre><code>43.75</code></pre>
</div>
</div>
<div class="cell" data-execution_count="262">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log the questions to W&amp;B.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"Hallucination Accuracy"</span>: hallucination_accuracy})</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"Hallucination Eval"</span>: eval_hallucination_df})</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="279">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> wandb.Api()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> api.run(<span class="st">"ayush-thakur/llama-index-report/6wxg2tbb"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>run.summary[<span class="st">"Hallucination Accuracy"</span>] <span class="op">=</span> hallucination_accuracy</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>run.summary.update()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate-the-retrieved-documents" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-the-retrieved-documents">Evaluate the Retrieved Documents</h2>
<div class="cell" data-execution_count="251">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cf6f6c66c85949df850e203d8182253e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/hed03acv
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="252">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build service context</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> OpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model<span class="op">=</span><span class="st">"gpt-4"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(llm<span class="op">=</span>llm, callback_manager<span class="op">=</span>callback_manager)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define evaluator</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> ResponseEvaluator(service_context<span class="op">=</span>service_context)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># query index</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>query_engine <span class="op">=</span> index.as_query_engine()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="253">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>eval_results <span class="op">=</span> []</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>responses <span class="op">=</span> []</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>chunks <span class="op">=</span> []</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, question <span class="kw">in</span> question_df.iterrows():</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> query_engine.query(question.questions)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    eval_result <span class="op">=</span> evaluator.evaluate_source_nodes(response)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    chunks.append([<span class="ss">f"</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">.chunk: </span><span class="sc">{</span>source_node<span class="sc">.</span>node<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> idx, source_node <span class="kw">in</span> <span class="bu">enumerate</span>(response.source_nodes)])</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    responses.append(response.response)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    eval_results.append(eval_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="254">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>eval_results_to_num <span class="op">=</span> []</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> eval_result <span class="kw">in</span> eval_results:</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_response <span class="kw">in</span> eval_result:</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eval_response<span class="op">==</span><span class="st">"YES"</span>:</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>            score<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>            score<span class="op">+=</span><span class="dv">0</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    eval_results_to_num.append(score<span class="op">/</span><span class="bu">len</span>(eval_result))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="255">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>eval_retrieve_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">"question"</span>, <span class="st">"retrieved chunks"</span>, <span class="st">"llm_response"</span>, <span class="st">"raw_eval_result"</span>, <span class="st">"eval_score"</span>],</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(<span class="bu">list</span>(df.questions.values), chunks, responses, eval_results, eval_results_to_num))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>eval_retrieve_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="255">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">retrieved chunks</th>
<th data-quarto-table-cell-role="th">llm_response</th>
<th data-quarto-table-cell-role="th">raw_eval_result</th>
<th data-quarto-table-cell-role="th">eval_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
<td>[0.chunk: Judaism Christianity Islam Buddhism ...</td>
<td>\nThe Llama 2-Chat7B model has higher sentimen...</td>
<td>[YES, YES]</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
<td>[0.chunk: 0.23 0.06\nMPT-instruct 7B 0.13 0.29...</td>
<td>\nThe sentiment scores for the Llama 27B model...</td>
<td>[NO, YES]</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
<td>[0.chunk: 0.23 0.06\nMPT-instruct 7B 0.13 0.29...</td>
<td>\nWe can conclude that the sentiment towards t...</td>
<td>[YES, NO]</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
<td>[0.chunk: 0.23 0.06\nMPT-instruct 7B 0.13 0.29...</td>
<td>\nThe mean sentiment scores for the different ...</td>
<td>[YES, YES]</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
<td>[0.chunk: Category Prompt\nCreative writingWri...</td>
<td>\nIn the short story, the dragon's realization...</td>
<td>[NO, NO]</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>retrieval_accuracy <span class="op">=</span> eval_retrieve_df.eval_score.values.<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(eval_retrieve_df)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>retrieval_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="306">
<pre><code>0.640625</code></pre>
</div>
</div>
<div class="cell" data-execution_count="256">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log the questions to W&amp;B.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"Retrieval Accuracy"</span>: retrieval_accuracy})</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"Retrieval Eval"</span>: eval_retrieve_df})</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="utility-for-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="utility-for-evaluation">Utility for Evaluation</h3>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.evaluation <span class="im">import</span> ResponseEvaluator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_eval_questions():</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the questions from the W&amp;B tables (this demonstrates the closing of the loop)</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    run <span class="op">=</span> wandb.init(project<span class="op">=</span><span class="st">"llama-index-report"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    artifact <span class="op">=</span> run.use_artifact(<span class="st">'ayush-thakur/llama-index-report/run-liu8ghm6-GeneratedQuestions:v0'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'run_table'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    artifact_dir <span class="op">=</span> artifact.download()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"</span><span class="sc">{</span>artifact_dir<span class="sc">}</span><span class="ss">/Generated Questions.table.json"</span>) <span class="im">as</span> f:</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.load(f)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> data[<span class="st">"columns"</span>]</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    questions <span class="op">=</span> data[<span class="st">"data"</span>]</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    question_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>columns, data<span class="op">=</span>questions)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    wandb.finish()</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> question_df</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> retrieval_eval_result_to_num(eval_results):</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    eval_results_to_num <span class="op">=</span> []</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_result <span class="kw">in</span> eval_results:</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> eval_response <span class="kw">in</span> eval_result:</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> eval_response<span class="op">==</span><span class="st">"YES"</span>:</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>                score<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>                score<span class="op">+=</span><span class="dv">0</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        eval_results_to_num.append(score<span class="op">/</span><span class="bu">len</span>(eval_result))</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> eval_results_to_num</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_hallucination_accuracy(eval_results):</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_result <span class="kw">in</span> eval_results:</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eval_result <span class="op">==</span> <span class="st">"YES"</span>:</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>            score <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (score<span class="op">/</span><span class="bu">len</span>(eval_results))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate(query_engine, question_df, callback_manager):</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># llm for evaluating hallucination</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>    h_llm <span class="op">=</span> OpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>)</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>    h_service_context <span class="op">=</span> ServiceContext.from_defaults(llm<span class="op">=</span>h_llm, callback_manager<span class="op">=</span>callback_manager)</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>    h_evaluator <span class="op">=</span> ResponseEvaluator(service_context<span class="op">=</span>service_context)</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># llm for evaluating retrieval</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>    r_llm <span class="op">=</span> OpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model<span class="op">=</span><span class="st">"gpt-4"</span>)</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>    r_service_context <span class="op">=</span> ServiceContext.from_defaults(llm<span class="op">=</span>r_llm, callback_manager<span class="op">=</span>callback_manager)</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>    r_evaluator <span class="op">=</span> ResponseEvaluator(service_context<span class="op">=</span>service_context)</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>    h_eval_results <span class="op">=</span> []</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>    r_eval_results <span class="op">=</span> []</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span> []</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run evaluation</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, question <span class="kw">in</span> tqdm(question_df.iterrows()):</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> query_engine.query(question.questions)</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Hallucination Evaluation</span></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>            h_eval_result <span class="op">=</span> h_evaluator.evaluate(response)</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Retrieved chunks evaluation</span></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>            r_eval_result <span class="op">=</span> r_evaluator.evaluate_source_nodes(response)</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>            h_eval_results.append(h_eval_result)</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>            chunks.append([<span class="ss">f"</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">.chunk: </span><span class="sc">{</span>source_node<span class="sc">.</span>node<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> idx, source_node <span class="kw">in</span> <span class="bu">enumerate</span>(response.source_nodes)])</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>            responses.append(response.response)</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>            r_eval_results.append(r_eval_result)</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"failed"</span>)</span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>            h_eval_results.append(<span class="va">None</span>)</span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>            responses.append(<span class="va">None</span>)</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>            chunks.append(<span class="va">None</span>)</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>            r_eval_results.append(<span class="va">None</span>)</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataframes</span></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>    eval_hallucination_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="st">"question"</span>, <span class="st">"llm_response"</span>, <span class="st">"eval_result"</span>],</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(<span class="bu">list</span>(question_df.questions.values), responses, h_eval_results))</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>    r_eval_results_to_num <span class="op">=</span> retrieval_eval_result_to_num(r_eval_results)</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>    eval_retrieve_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="st">"question"</span>, <span class="st">"retrieved chunks"</span>, <span class="st">"llm_response"</span>, <span class="st">"raw_eval_result"</span>, <span class="st">"eval_score"</span>],</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(<span class="bu">list</span>(question_df.questions.values), chunks, responses, r_eval_results, r_eval_results_to_num))</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute overall metrics</span></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>    hallucination_accuracy <span class="op">=</span> compute_hallucination_accuracy(<span class="bu">list</span>(eval_hallucination_df.eval_result))</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>    retrieval_accuracy <span class="op">=</span> eval_retrieve_df.eval_score.values.<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(eval_retrieve_df)</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wandb.run:</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>        wandb.log({</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Hallucination Eval"</span>: eval_hallucination_df,</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Retrieval Eval"</span>: eval_retrieve_df,</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Hallucination Accuracy"</span>: hallucination_accuracy,</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Retrieval Accuracy"</span>: retrieval_accuracy,</span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> eval_hallucination_df, eval_retrieve_df, hallucination_accuracy, retrieval_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="441">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> SimpleKeywordTableIndex, KeywordTableIndex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="442">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(callback_manager<span class="op">=</span>callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8856dc0a039f4f138f492d9f390dc562","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/s4fggue7
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="443">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>keyword_index <span class="op">=</span> KeywordTableIndex.from_documents(documents, service_context<span class="op">=</span>service_context)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># simple_keyword_index = SimpleKeywordTableIndex.from_documents(documents, service_context=service_context)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="343">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>query_engine <span class="op">=</span> keyword_index.as_query_engine()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="326">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"Who wrote this paper?"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="327">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"What is this paper about?"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="328">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> query_engine.query(<span class="st">"For how many steps the Llama 2 model was trained for?"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

Llama 2 was trained for two trillion tokens and was fine-tuned for up to 20 turns with GAtt to maintain 100% accuracy in referring to defined attributes. We tested the model's ability to remember system arguments through a human evaluation and observed a binary split pattern in reward distribution, especially with a larger margin. We also observed a distribution of mean sentiment scores across groups under the religious and political ideology domains from the BOLD prompts, with pretrained MPT7B scores of 0.20, 0.31, 0.20, 0.33, and 0.31, and fine-tuned Llama 2-Chat7B scores of 0.55, 0.50, 0.48, 0.45, and 0.62. This indicates that the model was trained for a total of 20 steps.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="329">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate-the-keywordtableindex" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-the-keywordtableindex">Evaluate the KeywordTableIndex</h3>
<div class="cell" data-execution_count="344">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0cf48e89a84b4bd8b6ce79ac0e23955c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/ra17h76z
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="335">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>question_df <span class="op">=</span> download_eval_questions()</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>question_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
Successfully finished last run (ID:97v4e5qx). Initializing new run:<br>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"179350043b9844daabab456200ae9483","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
wandb version 0.15.5 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.15.2
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>/Users/ayushthakur/integrations/llamaindex/llama_index/wandb/run-20230724_161913-j381yip5</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/j381yip5" target="_blank">feasible-wood-18</a></strong> to <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>
</div>
<div class="cell-output cell-output-display">
 View project at <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report</a>
</div>
<div class="cell-output cell-output-display">
 View run at <a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/j381yip5" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report/runs/j381yip5</a>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb:   1 of 1 files downloaded.  </code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1156c16b524043a6a1efe9c763318d5e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
 View run <strong style="color:#cdcd00">feasible-wood-18</strong> at: <a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/j381yip5" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report/runs/j381yip5</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>./wandb/run-20230724_161913-j381yip5/logs</code>
</div>
<div class="cell-output cell-output-display" data-execution_count="335">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="345">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>eval_hallucination_df, eval_retrieve_df, hallucination_accuracy, retrieval_accuracy <span class="op">=</span> evaluate(query_engine, question_df, callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
1it [00:24, 24.15s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
2it [01:34, 51.08s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
3it [02:10, 44.57s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
4it [02:56, 45.03s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
5it [03:07, 32.58s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
6it [03:26, 27.93s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
7it [03:36, 22.33s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
8it [04:02, 23.43s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
9it [04:25, 23.19s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
10it [05:12, 30.46s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
11it [05:21, 24.18s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
12it [05:29, 19.02s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
13it [05:38, 15.99s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
14it [05:54, 16.10s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
15it [06:59, 30.80s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
16it [07:47, 35.85s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
17it [07:58, 28.46s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
18it [08:22, 27.20s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
19it [08:28, 20.91s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
20it [09:06, 26.03s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
21it [09:25, 23.83s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
22it [09:47, 23.15s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
23it [10:24, 27.35s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
24it [10:53, 27.98s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
25it [11:00, 21.75s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
26it [11:06, 16.95s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
27it [11:21, 16.33s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
28it [12:07, 25.33s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
29it [12:52, 31.27s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
30it [13:46, 37.90s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
31it [14:09, 33.59s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
32it [14:37, 27.43s/it]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="351">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="346">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>eval_hallucination_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="346">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">llm_response</th>
<th data-quarto-table-cell-role="th">eval_result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
<td>\n\nThe Llama 2-Chat7B model had higher sentim...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
<td>\n\nThe Llama 27B model had the highest sentim...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
<td>\n\nBased on the distribution of mean sentimen...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
<td>\n\nThe mean sentiment scores for different gr...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
<td>\nThe events or experiences that led the drago...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>How did the discovery of Anne Frank's diary co...</td>
<td>\n\nThe discovery of Anne Frank's diary has ha...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>What is the historical significance of the ele...</td>
<td>\nThe Republican Party is depicted as an eleph...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>How can assumptions and stereotypes based on p...</td>
<td>\n\nMaking assumptions and stereotypes based o...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>How does the distribution of human preference ...</td>
<td>\n\nThe distribution of human preference data ...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>What is the impact of the safety auxiliary los...</td>
<td>\n\nThe ablation study showed that the safety ...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>How does a person's face shape and hair textur...</td>
<td>\nThe shape of a person's face and the texture...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>What are some popular haircuts that can comple...</td>
<td>\nSome popular haircuts that can complement va...</td>
<td>NO</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>How can a pixie cut hairstyle enhance the feat...</td>
<td>\nA pixie cut hairstyle can enhance the featur...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>What are some versatile haircuts that tend to ...</td>
<td>\nSome versatile haircuts that tend to look go...</td>
<td>NO</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>How does Llama 2-Chat, a collection of pretrai...</td>
<td>\n\nLlama 2-Chat models generally perform bett...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>What are the key contributions and approach de...</td>
<td>\n\nThe key contributions and approach describ...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Based on the context information provided, wha...</td>
<td>\nAnswer: Scaling Instruction-Finetuned Langua...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Which paper explores the surprising difficulty...</td>
<td>\n\nThe paper "CommonsenseQA: A Question Answe...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>According to the context information, what is ...</td>
<td>\nThe title of the paper by Sasha Luccioni, No...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Which conference hosted the 39th International...</td>
<td>\n\nThe 39th International Conference on Machi...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>How does a Ponzi scheme operate and what are t...</td>
<td>\nA Ponzi scheme is a type of investment scam ...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>As a teacher, how would you explain the steps ...</td>
<td>\nAs a teacher, it is important to explain the...</td>
<td>NO</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>How does the false refusal rate vary with the ...</td>
<td>\n\nThe false refusal rate increases with the ...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Can you provide examples of false refusal due ...</td>
<td>\nYes, examples of false refusal due to percei...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>What is the protagonist's opinion on folding p...</td>
<td>\nThe protagonist has a strong opinion that pi...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>According to the context information, what are...</td>
<td>\nThe protagonist thinks that pineapples on pi...</td>
<td>NO</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>According to the context information, what is ...</td>
<td>\n\nThe author's opinion on New York-style piz...</td>
<td>NO</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>How does the author suggest being respectful a...</td>
<td>\n\nThe author suggests being respectful and o...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>How does the new technique, Ghost Attention (G...</td>
<td>\n\nGhost Attention (GAtt) helps control dialo...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>What were the findings regarding the quality a...</td>
<td>\n\nThe findings regarding the quality and div...</td>
<td>YES</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>What is the purpose of utilizing an autoregres...</td>
<td>\n\nThe purpose of utilizing an autoregressive...</td>
<td>YES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>How many epochs are used for fine-tuning the m...</td>
<td>\n\nThe number of epochs used for fine-tuning ...</td>
<td>YES</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="347">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>hallucination_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="347">
<pre><code>59.375</code></pre>
</div>
</div>
<div class="cell" data-execution_count="350">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>retrieval_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="350">
<pre><code>0.016666666666666666</code></pre>
</div>
</div>
</section>
</section>
<section id="cross-encoder" class="level2">
<h2 class="anchored" data-anchor-id="cross-encoder">Cross Encoder</h2>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.indices.postprocessor <span class="im">import</span> SentenceTransformerRerank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> ServiceContext</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.callbacks <span class="im">import</span> CallbackManager, WandbCallbackHandler</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(callback_manager<span class="op">=</span>callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/37o7uxez
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> VectorStoreIndex.from_documents(documents, service_context<span class="op">=</span>service_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>rerank <span class="op">=</span> SentenceTransformerRerank(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"cross-encoder/ms-marco-MiniLM-L-2-v2"</span>, top_n<span class="op">=</span><span class="dv">3</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ce_query_engine <span class="op">=</span> index.as_query_engine(similarity_top_k<span class="op">=</span><span class="dv">10</span>, node_postprocessors<span class="op">=</span>[rerank])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> ce_query_engine.query(<span class="st">"Who wrote this paper?"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
The authors of this paper are Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, Ahmad Al-Dahle, Manohar Paluri, Joshua Ainslie, James Lee-Thorp, Michiel de Jong, Yury Zemlyanskiy, Federico Lebrón, Sumit Sanghai, Ebtesam Almazrouei, Hamza Alobeidli, Abdulaziz Alshamsi, Alessandro Cappelli, Ruxandra Cojocaru, Merouane Debbah, Etienne Goffinet, Daniel Heslow, Julien Launay, Quentin Malartic, Badreddine Noune, Baptiste Pannier, and Guilherme Penedo.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> ce_query_engine.query(<span class="st">"What is this paper about?"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
This paper is about the development of a general language assistant, trained with reinforcement learning from human feedback, and its evaluation using human annotators. It discusses the impact of system prompts on the performance of the model, and presents an evaluation methodology for comparing two models side-by-side. It also provides references to related work in the field.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> ce_query_engine.query(<span class="st">"For how many steps the Llama 2 model was trained for?"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Llama 2 was trained for two steps: pretraining and fine-tuning.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="evaluate-cross-encoder" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-cross-encoder">Evaluate Cross Encoder</h3>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b86aae3c1d034feb95b6f57f1ffa81bd","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/eywhg1dr
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>question_df <span class="op">=</span> download_eval_questions()</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>question_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
Successfully finished last run (ID:eywhg1dr). Initializing new run:<br>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.15.5 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.15.2
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>/Users/ayushthakur/integrations/llamaindex/llama_index/wandb/run-20230725_034156-6hmi3dbk</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/6hmi3dbk" target="_blank">stoic-wave-27</a></strong> to <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>
</div>
<div class="cell-output cell-output-display">
 View project at <a href="https://wandb.ai/ayush-thakur/llama-index-report" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report</a>
</div>
<div class="cell-output cell-output-display">
 View run at <a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/6hmi3dbk" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report/runs/6hmi3dbk</a>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb:   1 of 1 files downloaded.  </code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
 View run <strong style="color:#cdcd00">stoic-wave-27</strong> at: <a href="https://wandb.ai/ayush-thakur/llama-index-report/runs/6hmi3dbk" target="_blank">https://wandb.ai/ayush-thakur/llama-index-report/runs/6hmi3dbk</a><br>Synced 7 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>./wandb/run-20230725_034156-6hmi3dbk/logs</code>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>In the context of religious ideologies, compar...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Analyze the distribution of mean sentiment sco...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Based on the distribution of mean sentiment sc...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>How do the mean sentiment scores vary for diff...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>In the short story about a dragon who was evil...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="56">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>eval_hallucination_df, eval_retrieve_df, hallucination_accuracy, retrieval_accuracy <span class="op">=</span> evaluate(ce_query_engine, question_df, callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
1it [00:14, 14.74s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
2it [00:26, 12.88s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
3it [00:32, 10.04s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
4it [00:39,  8.46s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
5it [00:52, 10.22s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
6it [01:03, 10.66s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
7it [01:11,  9.62s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
8it [01:21,  9.94s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
9it [01:28,  8.73s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
10it [01:35,  8.41s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
11it [02:22, 20.19s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
12it [02:31, 16.69s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
13it [02:39, 14.03s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
14it [02:49, 12.95s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
15it [02:56, 11.02s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
16it [03:08, 11.52s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
17it [03:16, 10.37s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
18it [03:22,  9.09s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
19it [03:27,  7.87s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
20it [03:33,  7.18s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
21it [03:51, 10.46s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
22it [04:14, 14.20s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
23it [04:22, 12.42s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
24it [04:34, 12.13s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
25it [04:41, 10.66s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
26it [04:46,  9.03s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
27it [04:53,  8.27s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
28it [05:00,  7.91s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
29it [05:08,  8.17s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
30it [05:17,  8.17s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
31it [05:23,  7.53s/it]wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
32it [05:27, 10.23s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="flare-query-engine" class="level2">
<h2 class="anchored" data-anchor-id="flare-query-engine">FLARE Query Engine</h2>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> ServiceContext</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.callbacks <span class="im">import</span> CallbackManager, WandbCallbackHandler</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(callback_manager<span class="op">=</span>callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/n5zsz560
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> VectorStoreIndex.from_documents(documents, service_context<span class="op">=</span>service_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>query_engine <span class="op">=</span> index.as_query_engine()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.query_engine <span class="im">import</span> FLAREInstructQueryEngine</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>index_query_engine <span class="op">=</span> index.as_query_engine(similarity_top_k<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>flare_query_engine <span class="op">=</span> FLAREInstructQueryEngine(</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    query_engine<span class="op">=</span>index_query_engine,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    service_context<span class="op">=</span>service_context,</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    max_iterations<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> flare_query_engine.query(<span class="st">"Who wrote this paper?"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Query: Who wrote this paper?
Current response: 
Lookahead response: This paper was written by [Search(Who wrote this paper?)].
Updated lookahead response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors.
Current response:  This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors.
Lookahead response: [Search(Who are the contributors listed in Appendix A.1 Contributions?)]
Updated lookahead response: The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan.
Current response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan.
Lookahead response: [Search(Who are the Science and Engineering Leadership contributors in Appendix A.1 Contributions?)]
Updated lookahead response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, with Science and Engineering Leadership contributors being Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, and Hugo Touvron.
Current response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan. This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, with Science and Engineering Leadership contributors being Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, and Hugo Touvron.
Lookahead response: Technical and Management Leadership contributors are Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, and Robert Stojnic. Core Contributors are Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan.
Updated lookahead response: Technical and Management Leadership contributors are Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, and Robert Stojnic. Core Contributors are Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan.
Current response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan. This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, with Science and Engineering Leadership contributors being Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, and Hugo Touvron. Technical and Management Leadership contributors are Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, and Robert Stojnic. Core Contributors are Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan.
Lookahead response: Contributors in the Contributors section are [Search(What are the names of the contributors in the Contributors section of Appendix A.1?)].
Updated lookahead response: Contributors in the Contributors section are Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan.
Current response: This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan. This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, with Science and Engineering Leadership contributors being Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, and Hugo Touvron. Technical and Management Leadership contributors are Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, and Robert Stojnic. Core Contributors are Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan. Contributors in the Contributors section are Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan.
Lookahead response: done
This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan. This paper was written by the contributors listed in the Appendix A.1 Contributions section, including Science and Engineering Leadership, Technical and Management Leadership, Core Contributors, and Contributors. The contributors listed in Appendix A.1 Contributions are: Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, Hugo Touvron, Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, Zheng Yan, with Science and Engineering Leadership contributors being Guillem Cucurull, Naman Goyal, Louis Martin, Thomas Scialom, Ruan Silva, Kevin Stone, and Hugo Touvron. Technical and Management Leadership contributors are Sergey Edunov, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, and Robert Stojnic. Core Contributors are Peter Albert, Nikolay Bashlykov, Prajjwal Bhargava, Moya Chen, David Esiobu, Jeremy Fu, Vedanuj Goswami, Anthony Hartshorn, Rui Hou, Marcin Kardas, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Diana Liskovich, Xavier Martinet, Yuning Mao, Igor Molybog, Todor Mihaylov, Andrew Poulton, Jeremy Reizenstein, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Jacob Xu, Yuchen Zhang, Iliyan Zarov, Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan. Contributors in the Contributors section are Amjad Almahairi, Yasmine Babaei, Soumya Batra, Lukas Blecher, Dan Bikel, Shruti Bhosale, Cristian Canton Ferrer, Jude Fernandes, Wenyin Fu, Brian Fuller, Cynthia Gao, Saghar Hosseini, Hakan Inan, Isabel Kloumann, Madian Khabsa, Artem Korenev, Viktor Kerkez, Jian Xiang Kuan, Yinghai Lu, Jenya Lee, Pushkar Mishra, Yixin Nie, Rashi Rungta, Alan Schelten, Kalyan Saladi, Adina Williams, and Zheng Yan. </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> flare_query_engine.query(<span class="st">"For how many steps the Llama 2 model was trained for?"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Query: For how many steps the Llama 2 model was trained for?
Current response: 
Lookahead response: The Llama 2 model was trained for [Search(How many steps was the Llama 2 model trained for?)] steps.
Updated lookahead response: The Llama 2 model was trained for approximately 6 months steps.
Current response:  The Llama 2 model was trained for approximately 6 months steps.
Lookahead response: [Search(How many training steps did the Llama 2 model take?)]
Updated lookahead response: The Llama 2 model took 2 trillion tokens of data for pretraining.
Current response: The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining.
Lookahead response: It was then fine-tuned on [Search(What data was the Llama 2 model fine-tuned on?)] for an additional 2 million steps.
Updated lookahead response: It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps.
Current response: The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining. It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps.
Lookahead response: [Search(How many steps did the Llama 2 model take for fine-tuning?)]
Updated lookahead response: The Llama 2 model took two steps for fine-tuning: supervised fine-tuning (SFT) and reinforcement learning with human feedback (RLHF).
Current response: The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining. It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps. The Llama 2 model took two steps for fine-tuning: supervised fine-tuning (SFT) and reinforcement learning with human feedback (RLHF).
Lookahead response: The SFT step took 1 million steps and the RLHF step took 1 million steps.
Updated lookahead response: The SFT step took 1 million steps and the RLHF step took 1 million steps.
Current response: The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining. It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps. The Llama 2 model took two steps for fine-tuning: supervised fine-tuning (SFT) and reinforcement learning with human feedback (RLHF). The SFT step took 1 million steps and the RLHF step took 1 million steps.
Lookahead response: The total number of steps for the Llama 2 model was [Search(How many steps did the Llama 2 model take?)].
Updated lookahead response: The total number of steps for the Llama 2 model was 3 million.
Current response: The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining. It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps. The Llama 2 model took two steps for fine-tuning: supervised fine-tuning (SFT) and reinforcement learning with human feedback (RLHF). The SFT step took 1 million steps and the RLHF step took 1 million steps. The total number of steps for the Llama 2 model was 3 million.
Lookahead response: The total number of steps for the Llama 2 model was [Search(How many steps did the Llama 2 model take?)].
Updated lookahead response: The total number of steps for the Llama 2 model was 3 million.
The Llama 2 model was trained for approximately 6 months steps. The Llama 2 model took 2 trillion tokens of data for pretraining. It was then fine-tuned on publicly available instruction datasets, as well as over one million new human-annotated examples for an additional 2 million steps. The Llama 2 model took two steps for fine-tuning: supervised fine-tuning (SFT) and reinforcement learning with human feedback (RLHF). The SFT step took 1 million steps and the RLHF step took 1 million steps. The total number of steps for the Llama 2 model was 3 million. The total number of steps for the Llama 2 model was 3 million.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="persisting-index" class="level2">
<h2 class="anchored" data-anchor-id="persisting-index">Persisting Index</h2>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> ServiceContext</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index.callbacks <span class="im">import</span> CallbackManager, WandbCallbackHandler</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise WandbCallbackHandler and pass any wandb.init args</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>wandb_args <span class="op">=</span> {<span class="st">"project"</span>:<span class="st">"llama-index-report"</span>}</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>wandb_callback <span class="op">=</span> WandbCallbackHandler(run_args<span class="op">=</span>wandb_args)</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pass wandb_callback to the service context</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>callback_manager <span class="op">=</span> CallbackManager([wandb_callback])</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>service_context <span class="op">=</span> ServiceContext.from_defaults(callback_manager<span class="op">=</span>callback_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5aefd31861f94be3912f8a38f18a6d29","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Streaming LlamaIndex events to W&amp;B at https://wandb.ai/ayush-thakur/llama-index-report/runs/brl127tu
wandb: `WandbCallbackHandler` is currently in beta.
wandb: Please report any issues to https://github.com/wandb/wandb/issues with the tag `llamaindex`.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> VectorStoreIndex.from_documents(documents, service_context<span class="op">=</span>service_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: WARNING Serializing object of type str that is 509726 bytes
wandb: WARNING Serializing object of type str that is 515884 bytes
wandb: Logged trace tree to W&amp;B.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>wandb_callback.persist_index(index, index_name<span class="op">=</span><span class="st">"simple_vector_store"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Adding directory to artifact (/Users/ayushthakur/integrations/llamaindex/llama_index/wandb/run-20230725_141307-brl127tu/files/storage)... Done. 0.0s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> llama_index <span class="im">import</span> load_index_from_storage, load_graph_from_storage</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>storage_context <span class="op">=</span> wandb_callback.load_storage_context(</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    artifact_url<span class="op">=</span><span class="st">"ayush-thakur/llama-index-report/simple_vector_store:v0"</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the index and initialize a query engine</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>loaded_index <span class="op">=</span> load_index_from_storage(storage_context, service_context<span class="op">=</span>service_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb:   4 of 4 files downloaded.  </code></pre>
</div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>loaded_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>&lt;llama_index.indices.vector_store.base.VectorStoreIndex at 0x2f70dc2b0&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>